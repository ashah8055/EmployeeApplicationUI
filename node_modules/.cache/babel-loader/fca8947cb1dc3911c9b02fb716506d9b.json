{"ast":null,"code":"import _extends from 'babel-runtime/helpers/extends';\nimport _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport Icon from '../icon';\nimport classNames from 'classnames';\n\nvar Avatar = function (_React$Component) {\n  _inherits(Avatar, _React$Component);\n\n  function Avatar() {\n    _classCallCheck(this, Avatar);\n\n    var _this = _possibleConstructorReturn(this, (Avatar.__proto__ || Object.getPrototypeOf(Avatar)).apply(this, arguments));\n\n    _this.state = {\n      scale: 1,\n      isImgExist: true\n    };\n\n    _this.setScale = function () {\n      var childrenNode = _this.avatarChildren;\n\n      if (childrenNode) {\n        var childrenWidth = childrenNode.offsetWidth;\n        var avatarNode = ReactDOM.findDOMNode(_this);\n        var avatarWidth = avatarNode.getBoundingClientRect().width; // add 4px gap for each side to get better performance\n\n        if (avatarWidth - 8 < childrenWidth) {\n          _this.setState({\n            scale: (avatarWidth - 8) / childrenWidth\n          });\n        } else {\n          _this.setState({\n            scale: 1\n          });\n        }\n      }\n    };\n\n    _this.handleImgLoadError = function () {\n      var onError = _this.props.onError;\n      var errorFlag = onError ? onError() : undefined;\n\n      if (errorFlag !== false) {\n        _this.setState({\n          isImgExist: false\n        });\n      }\n    };\n\n    return _this;\n  }\n\n  _createClass(Avatar, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this.setScale();\n    }\n  }, {\n    key: 'componentDidUpdate',\n    value: function componentDidUpdate(prevProps, prevState) {\n      if (prevProps.children !== this.props.children || prevState.scale !== this.state.scale && this.state.scale === 1 || prevState.isImgExist !== this.state.isImgExist) {\n        this.setScale();\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _classNames,\n          _classNames2,\n          _this2 = this;\n\n      var _a = this.props,\n          prefixCls = _a.prefixCls,\n          shape = _a.shape,\n          size = _a.size,\n          src = _a.src,\n          icon = _a.icon,\n          className = _a.className,\n          alt = _a.alt,\n          others = __rest(_a, [\"prefixCls\", \"shape\", \"size\", \"src\", \"icon\", \"className\", \"alt\"]);\n\n      var _state = this.state,\n          isImgExist = _state.isImgExist,\n          scale = _state.scale;\n      var sizeCls = classNames((_classNames = {}, _defineProperty(_classNames, prefixCls + '-lg', size === 'large'), _defineProperty(_classNames, prefixCls + '-sm', size === 'small'), _classNames));\n      var classString = classNames(prefixCls, className, sizeCls, (_classNames2 = {}, _defineProperty(_classNames2, prefixCls + '-' + shape, shape), _defineProperty(_classNames2, prefixCls + '-image', src && isImgExist), _defineProperty(_classNames2, prefixCls + '-icon', icon), _classNames2));\n      var sizeStyle = typeof size === 'number' ? {\n        width: size,\n        height: size,\n        lineHeight: size + 'px',\n        fontSize: icon ? size / 2 : 18\n      } : {};\n      var children = this.props.children;\n\n      if (src && isImgExist) {\n        children = React.createElement('img', {\n          src: src,\n          onError: this.handleImgLoadError,\n          alt: alt\n        });\n      } else if (icon) {\n        children = React.createElement(Icon, {\n          type: icon\n        });\n      } else {\n        var childrenNode = this.avatarChildren;\n\n        if (childrenNode || scale !== 1) {\n          var transformString = 'scale(' + scale + ') translateX(-50%)';\n          var childrenStyle = {\n            msTransform: transformString,\n            WebkitTransform: transformString,\n            transform: transformString\n          };\n          var sizeChildrenStyle = typeof size === 'number' ? {\n            lineHeight: size + 'px'\n          } : {};\n          children = React.createElement('span', {\n            className: prefixCls + '-string',\n            ref: function ref(span) {\n              return _this2.avatarChildren = span;\n            },\n            style: _extends({}, sizeChildrenStyle, childrenStyle)\n          }, children);\n        } else {\n          children = React.createElement('span', {\n            className: prefixCls + '-string',\n            ref: function ref(span) {\n              return _this2.avatarChildren = span;\n            }\n          }, children);\n        }\n      }\n\n      return React.createElement('span', _extends({}, others, {\n        style: _extends({}, sizeStyle, others.style),\n        className: classString\n      }), children);\n    }\n  }]);\n\n  return Avatar;\n}(React.Component);\n\nexport default Avatar;\nAvatar.defaultProps = {\n  prefixCls: 'ant-avatar',\n  shape: 'circle',\n  size: 'default'\n};","map":null,"metadata":{},"sourceType":"module"}